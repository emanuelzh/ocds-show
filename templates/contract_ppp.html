
<section id="contract-{{loop.index}}">
  <h3>
    {% if contract.title %}{{ contract.title}}{% else %}{{ gettext("No title provided") }}{% endif %} {{change_label(contract)}} 
    <small> 
      ({% if contract.id %}
        {{ contract.id }} {{change_label(contract, 'id')}}
      {% else %}
        {{ gettext("No ID provided") }}
      {% endif %})
    </small>
  </h3>
  <div class="row">
    <div class="col-xs-12">
      <div class="panel panel-{% if planning.budget.amount.amount %}default{% else %}warning{% endif %}">
        <div class="panel-body">
          {% if contract.description %}
            {{ contract.description }} {{change_label(contract, 'awardID')}}
          {% else %}
            {{ gettext("No description provided") }}
          {% endif %}
          <dl> 
             <dt class="dt-large dt-inline dt-gap">
              {{ gettext("Award ID") }}
             </dt>
             <dd class="dd-large dd-inline dd-gap">
              {% if contract.awardID %}
                {{ contract.awardID }} {{change_label(contract, 'awardID')}}
              {% else %}
                {{ gettext("No award ID provided") }}
              {% endif %}
             </dd>

             <dt class="dt-large dt-inline">
               {{ gettext("Status") }}
             </dt>
             <dd class="dd-large dd-inline">
               {% if contract.status %}
                 {{ contract.status }} {{change_label(contract, 'status')}}
               {% else %}
                 {{ gettext("No status provided") }}
               {% endif %}
             </dd>


             <dt class="dt-large dt-gap">
               {{ gettext("Contract Period")}}
             </dt>
             <dd class="dd-small">
                {{change_label(contract, 'period')}}

                <strong>{{ gettext("Start: ")}}</strong>
                {% if contract.period.startDate %}
                  {{ contract.period.startDate|truncate(10,true,"")}}
                  {{change_label(contract.period, 'startDate')}}
                {% else %}
                  <span class="bg-warning">{{ gettext("No start date provided") }}</span>
                {% endif %}
                <strong class="gap-left">{{ gettext("End: ")}}</strong>
                {% if contract.period.endDate %}
                  {{ contract.period.endDate|truncate(10,true,"")}}
                  {{change_label(contract.period, 'endDate')}}
                {% else %}
                  <span class="bg-warning">{{ gettext("No end date provided") }}</span>
                {% endif %}
             </dd>
             <dt class="dt-large dt-inline dt-gap">
               {{ gettext("Value") }}
             </dt>
             <dd class="dd-large dd-inline dd-gap">
               {{change_label(contract, 'value')}}
               {% if contract.value.amount %}
                 {{ contract.value.amount|currency }}
                 {{change_label(contract.value, 'amount')}}
                 {{contract.value.currency}}
                 {{change_label(contract.value, 'currency')}}
               {% else %}
                 {{ gettext("Value not provided") }}
               {% endif %}
              </dd>
             <dt class="dt-large dt-inline">
               {{ gettext("Date signed")}}
             </dt>
             <dd class="dd-large dd-inline">
               {% if contract.dateSigned %}
                 {{contract.dateSigned|truncate(10,true,"")}}
                 {{change_label(contract, 'dateSigned')}}
               {% else %}
                 <span class="bg-warning">{{ gettext("No date provided") }}</span>
               {% endif %}
             </dd>

           </dl> 


        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      {% if contract.items %}
        {% set items = contract.items %}
        {% set parent = contract %}
        {% include 'items.html' %}
      {% else %}
        <div class="panel panel-warning">
          <div class="panel-heading">
            <h3 class="panel-title">
              {{ gettext("Items") }}
            </h3>
          </div>
          <div class="panel-body">
            {{ gettext("No items provided") }}
          </div>
        </div>
      {% endif %}
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      {% if contract.documents %}
        {% set documents = contract.documents %}
        {% set parent = contract %}
        {% include 'documents.html' %}
      {% else %}
        <div class="panel panel-warning">
          <div class="panel-heading">
            <h3 class="panel-title">
              {{ gettext("Documents") }}
            </h3>
          </div>
          <div class="panel-body">
            {{ gettext("No documents provided") }}
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  {% if contract.relatedProcesses %}
  <div class="row">
    <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">
            {{ gettext("Related Processes") }}
          </h3>
        </div>
        <div class="panel-body">
          <table class="table table-striped table-responsive">
            <thead>
              <tr>
                <th>
                  Title
                </th>
                <th>
                  ID
                </th>
                <th>
                  OCID
                </th>
                <th>
                  Relationship
                </th>
              </tr>
            </thead>
            <tbody>
              {% for relatedProcess in contract.relatedProcesses %}
              <tr>
                <td>
                  {% if relatedProcess.uri %}
                    <a href="{{relatedProcess.uri}}"> {{relatedProcess.title}} </a>
                  {% else %}
                    {{relatedProcess.title}}
                  {% endif %}
                </td>
                <td>
                  {{relatedProcess.id}}
                </td>
                <td>
                  {{relatedProcess.ocid}}
                </td>
                <td>
                  {{relatedProcess.relationship|join(", ")}}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <div class="row">
    <div class="col-md-12">
      {% if contract.milestones %}
        {% set milestones = contract.milestones %}
        {% set parent = contract %}
        {% include 'milestones.html' %}
      {% else %}
        <div class="panel panel-warning">
          <div class="panel-heading">
            <h3 class="panel-title">
              {{ gettext("Milestones") }}
            </h3>
          </div>
          <div class="panel-body">
            {{ gettext("No milestones provided") }}
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      {% if contract.agreedMetrics %}
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">
              {{ gettext("Agreed Metrics") }}
            </h3>
          </div>
          <div class="panel-body">
            {% set metrics = contract.agreedMetrics %}
            {% set parent = contract %}
            {% include 'metrics.html' %}
          </div>
        </div>
      {% else %}
        <div class="panel panel-warning">
          <div class="panel-heading">
            <h3 class="panel-title">
              {{ gettext("Agreed Metrics") }}
            </h3>
          </div>
          <div class="panel-body">
            {{ gettext("No Agreed Metrics provided") }}
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  {% if contract.finance %}
  <div class="row">
    <div class="col-xs-12">
      <div class="panel panel-default %}">
        <div class="panel-heading">
          <h3 class="panel-title">
            {{ gettext("Finance") }}
          </h3>
        </div>
        <div class="panel-body">
          {% for finance in contract.finance %}
            <div class="panel panel-default %}">
              <div class="panel-heading">
                <h4 class="panel-title">
                  {{ finance.title }} <small> ({{finance.id}}) </small>
                </h4>
              </div>
              <div class="panel-body">
                {% if finance.description %}
                  {{ finance.description }} {{change_label(finance, 'description')}}
                {% else %}
                  {{ gettext("No description provided") }}
                {% endif %}
                <dl> 
                  <dt class="dt-large dt-inline dt-gap">
                   {{ gettext("Financing Party") }}
                  </dt>
                  <dd class="dd-large dd-inline dd-gap">
                   {% if finance.financingParty %}
                   {{ finance.financingParty.name }} {{change_label(finance.financingParty, 'name')}} <small> ({{finance.financingParty.id}} {{change_label(finance.financingParty, 'id')}}) </small>
                   {% else %}
                     {{ gettext("No Financing Party provided") }}
                   {% endif %}
                  </dd>
                  <dt class="dt-large dt-inline">
                    {{ gettext("Value") }}
                  </dt>
                  <dd class="dd-large dd-inline">
                    {{change_label(finance, 'value')}}
                    {% if finance.value.amount %}
                      {{ finance.value.amount|currency }}
                      {{change_label(finance.value, 'amount')}}
                      {{finance.value.currency}}
                      {{change_label(finance.value, 'currency')}}
                    {% else %}
                      {{ gettext("Value not provided") }}
                    {% endif %}
                  </dd>

                  <dt class="dt-large dt-inline">
                    {{ gettext("Finance Type") }}
                  </dt>
                  <dd class="dd-large dd-inline">
                    {% if finance.financeType %}
                      {{ finance.financeType }} {{change_label(finance, 'financeType')}}
                    {% else %}
                      {{ gettext("No finance type provided") }}
                    {% endif %}
                  </dd>

                  <dt class="dt-large dt-inline">
                    {{ gettext("Finance Category") }}
                  </dt>
                  <dd class="dd-large dd-inline">
                    {% if finance.financeCategory %}
                      {{ finance.financeCategory }} {{change_label(finance, 'financeCategory')}}
                    {% else %}
                      {{ gettext("No finance category provided") }}
                    {% endif %}
                  </dd>

                  <dt class="dt-large dt-gap">
                    {{ gettext("Finance Period")}}
                  </dt>
                  <dd class="dd-small">
                     {{change_label(finance, 'period')}}

                     <strong>{{ gettext("Start: ")}}</strong>
                     {% if finance.period.startDate %}
                       {{ finance.period.startDate|truncate(10,true,"")}}
                       {{change_label(finance.period, 'startDate')}}
                     {% else %}
                       <span class="bg-warning">{{ gettext("No start date provided") }}</span>
                     {% endif %}
                     <strong class="gap-left">{{ gettext("End: ")}}</strong>
                     {% if finance.period.endDate %}
                       {{ finance.period.endDate|truncate(10,true,"")}}
                       {{change_label(finance.period, 'endDate')}}
                     {% else %}
                       <span class="bg-warning">{{ gettext("No end date provided") }}</span>
                     {% endif %}
                  </dd>

                  <dt class="dt-large dt-gap">
                    {{ gettext("Interest Rates")}}
                  </dt>
                  <dd class="dd-small">
                     {{change_label(finance, 'interestRate')}}

                     <strong>{{ gettext("Margin: ")}}</strong>
                     {% if finance.interestRate.margin %}
                       {{ finance.interestRate.margin }}
                       {{change_label(finance.interestRate, 'margin')}}
                     {% else %}
                       <span class="bg-warning">{{ gettext("No margin provided") }}</span>
                     {% endif %}

                     <strong class="gap-left">{{ gettext("Base: ")}}</strong>
                     {% if finance.interestRate.base %}
                       {{ finance.interestRate.base }}
                       {{change_label(finance.interestRate, 'base')}}
                     {% else %}
                       <span class="bg-warning">{{ gettext("No base provided") }}</span>
                     {% endif %}

                     {% if finance.interestRate.fixed %}
                       <strong class="gap-left">{{ gettext("Fixed: ")}}</strong>
                       {{ finance.interestRate.fixed }}
                       {{change_label(finance.interestRate, 'fixed')}}
                     {% endif %}

                     <br/>
                     <strong>{{ gettext("Notes: ")}}</strong>
                     {% if finance.interestRate.notes %}
                       {{ finance.interestRate.notes }}
                       {{change_label(finance.interestRate, 'notes')}}
                     {% else %}
                       <span class="bg-warning">{{ gettext("No notes provided") }}</span>
                     {% endif %}

                  </dd>
                </dl> 
              </div>
            </div>
          {% endfor%}
        </div>
      </div>
    </div>
  </div>
  {% endif %}


  {% if contract.financialModel %}
  <div class="row">
    <div class="col-xs-12">
      <div class="panel panel-default %}">
        <div class="panel-heading">
          <h3 class="panel-title">
            {{ gettext("Financial Model") }}
          </h3>
        </div>
        <div class="panel-body">
          {% for indicator in contract.financialModel %}
            <div class="panel panel-default %}">
              <div class="panel-heading">
                <h4 class="panel-title">
                  {{ indicator.title }} <small> ({{indicator.id}}) </small>
                </h4>
              </div>
              <div class="panel-body">
                {% if indicator.notes %}
                  {{ indicator.notes }} {{change_label(indicator, 'notes')}}
                {% endif %}
                <dl> 
                  <dt class="dt-large dt-inline dt-gap">
                   {{ gettext("Indicator Code") }}
                  </dt>
                  <dd class="dd-large dd-inline dd-gap">
                   {% if indicator.code %}
                   {{ indicator.code }} {{change_label(indicator, 'code')}}
                   {% else %}
                     {{ gettext("No Indicator Code Provided") }}
                   {% endif %}
                  </dd>
                  <dt class="dt-large dt-inline">
                    {{ gettext("Value") }}
                  </dt>
                  <dd class="dd-large dd-inline">
                     {% if indicator.value %}
                     {{ indicator.value }} {{change_label(indicator, 'value')}}
                     {% else %}
                       {{ gettext("No Indicator Value Provided") }}
                     {% endif %}
                  </dd>

                </dl> 
              </div>
            </div>
          {% endfor%}
        </div>
      </div>
    </div>
  </div>
  {% endif %}


  {% if contract.equityTransferCaps %}
  <div class="row">
    <div class="col-xs-12">
      <div class="panel panel-default %}">
        <div class="panel-heading">
          <h3 class="panel-title">
            {{ gettext("Equity Transfer Caps") }}
          </h3>
        </div>
        <div class="panel-body">
          {% for equityTransferCap in contract.equityTransferCaps %}
            <div class="panel panel-default %}">
              <div class="panel-heading">
                <h4 class="panel-title">
                  {{ equityTransferCap.title }} <small> ({{equityTransferCap.id}}) </small>
                </h4>
              </div>
              <div class="panel-body">
                {% if equityTransferCap.description %}
                  {{ equityTransferCap.description }} {{change_label(equityTransferCap, 'description')}}
                {% endif %}
                <dl> 
                  <dt class="dt-large dt-inline dt-gap">
                   {{ gettext("Amount") }}
                  </dt>
                  <dd class="dd-large dd-inline dd-gap">
                   {% if equityTransferCap.amount %}
                     {{ equityTransferCap.amount * 100 }}% {{change_label(equityTransferCap, 'amount')}}
                   {% else %}
                     {{ gettext("No Equitly Transfer Cap given ") }}
                   {% endif %}
                  </dd>
                  <dt class="dt-large dt-inline dt-gap">
                   {{ gettext("Milestone") }}
                  </dt>
                  <dd class="dd-large dd-inline dd-gap">
                   {% if equityTransferCap.title %}
                     {{ equityTransferCap.milestone.title }}% 
                     {{change_label(equityTransferCap.milestone, 'title')}}
                     <small>
                     ({{ equityTransferCap.milestone.id}}% 
                      {{ change_label(equityTransferCap.milestone, 'id')}})
                     </small>
                   {% else %}
                     {{ gettext("No Milestone Referenced") }}
                   {% endif %}
                  </dd>
                </dl> 
              </div>
            </div>
          {% endfor%}
        </div>
      </div>
    </div>
  </div>

  {% endif %}

</section>












